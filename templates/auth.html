<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ action }} - Autism Ally</title>
    <link rel="stylesheet" href="static/css/styles.css">
    <link rel="stylesheet" href="static/css/auth.css">
</head>
<body>
    <header>
	 <p>Autism Ally</p>
	 <nav>
	     <ul>
	     	<li><a href="/">Home</a></li>
	     	<li><a href="/login">Login</a></li>
	     	<li><a href="/signup">Sign Up</a></li>
	     </ul>
	 </nav>
    </header>
    <main class="auth-container">
	    <h1>{{ action }}</h1>
	    <form id="authForm" action="{{ url }}"  method="POST">
		    <label for="username">Username</label>
		    <input type="text" id="username" name="username" required>
		    {% if action == 'Sign Up' %}
		    	<label for="email">Email</label>
				<input type="email" id="email" name="email" required>
				<label for="city">City</label>
            	<input type="text" id="city" name="city" required>
		    {% endif %}
		    <label for="password">Password</label>
		    <input type="password" id="password" name="password" required>
		    <button type="submit">{{ action }}</button>
	    </form>
	    {% if action == 'Login' %}
	    	    <p>Don't have an account? <a href="/signup">Sign up</a></p>
	    {% else %}
	    	    <p>Already have an account? <a href="/login">Login</a></p>
	    {% endif %}
    </main>
	<script>
    	document.getElementById('authForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent the default form submission

        const formData = {
            username: event.target.username.value,
            email: event.target.email ? event.target.email.value : null,
            password: event.target.password.value,
            city: event.target.city.value
        };

        const url = '{{ url }}';

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Redirect to the dashboard
                window.location.href = '{{ url_for("dashboard") }}';
            } else {
                // Handle errors (e.g., user already exists)
                alert(data.message || 'Error signing up. Please try again.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
    </script>
</body>
</html>
